<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Wine Project</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!--google fonts-->
    <link href="https://fonts.googleapis.com/css2?family=Halant:wght@400;500;600;700&family=Open+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <!--plugins-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css"/>
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/animations/scale.css"/>
    <!--main style file-->
    <link rel="stylesheet" href="wineStyle.css">
    <!--js-->
    <script src="https://unpkg.com/@popperjs/core@2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6/dist/tippy-bundle.umd.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
</head>
<body data-spy="scroll" data-target="#header" data-offset="66">
<!--header-->
<nav id="header" class="navbar fixed-top navbar-light">
    <div class="container">
        <a class="navbar-brand" href="#"><img src="img/logo.png" width="80%"></a>
        <ul class="nav">
            <li class="nav-item">
                <a class="nav-link" href="#research">Our Research</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#taste">Taste Profile</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#recommendation">Details</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#tips">Tips</a>
            </li>
        </ul>
    </div>
</nav>

<!--Intro Page-->
<section id="intro">
    <div class="container">
        <h1 class="primary-title">A Guide to Wine Purchase</h1>
        <br>
        <div class="row">
            <div class="col-8">
                <p>
                    We all have this moment...<br><br>

                    Imagine yourself standing in front of the wine aisle of a store, wondering where to start.
                    The labels on the wine bottles are very informative, but often too informative to wine novice - cuz nothing really makes sense!<br><br>

                    <b>
                        Should I pick a wine based on its price, brand, variety, rating, region, year, or even more confusingly complex attributes,
                        like acidity, sweetness, body, aromas and colors?<br><br>
                    </b>

                    Conventional apps often start from recommending a list of wines from an expert perspective. We believe wine preference is subjective.
                    The best way to know whether you like the wine or not is to taste it yourself.
                    Yet what if you can‚Äôt taste wines when you have to purchase one at a grocery store?
                    Our project is uniquely positioned to recommend young people in their 20s affordable wines based on flavors.
                    Hope you can become a more confident wine buyer with the help of our project!
                </p>
            </div>
            <div class="col-4">
                <img src="img/intro.png" width="110%">
            </div>
        </div>
        <a href="#research"><img class="content-margin" id="btnToIntro" src="img/icon/down.png" onclick="showIntro()"></a>
    </div>
</section>

<!--Research-->
<section id="research">
    <div class="container">
        <h1 class="primary-title-colored">Our Research</h1>
        <br>
        <h4 class="secondary-title-colored">Drinking frequency among different age groups</h4>
        <br>
        <div class="row">
            <div class="col-6">
                <img src="img/research_viz1.png" width="90%">
            </div>
            <div class="col-6">
                <p style="padding-top: 2rem;">
                    The change in wine drinking frequency showed that <b>the 21-29 group is the only significantly growing market segment</b>.
                    47% of the 20s expressed ‚Äúdrinking more wine‚Äù than a couple years ago. As age grows, people tend to maintain the same frequencies and rather than drink more.
                    <br><br>

                    Since 21 is the legal drinking age in the US, it makes sense that 21-29 years old are new to the wine world to learn and explore.
                    We decided to target the 21-29 years old, who <b>have the strongest demand to explore wines but limited wine knowledge</b>.
                </p>
            </div>
        </div>
        <h4 class="secondary-title-colored content-margin">Understand affordable price & wine rating</h4>
        <br>
        <div class="row">
            <div class="col-6">
                <p>
                    Q: What does affordability mean for wine purchasers ? <br><br>

                    <b>The majority of wine drinkers never bought wines priced over $30</b>, while wines under $30 are popular among drinkers.
                    For the sake of affordability for people in their 20s who are presumably price sensitive, we decided to recommend wines under $30 from our dataset.
                </p>
            </div>
            <div class="col-6">
                <p>
                    Q: Are expensive wines better than cheaper (affordable) wines ?<br><br>

                    Not necessarily. There is some positive correlation between wine prices and ratings, but higher price does not guarantee better wines.
                    The most expensive wine ($3300) in the dataset is not rated high by wine connoisseurs. Given the huge variations at each price level,
                    <b>affordable wines can also be good and sometimes better than expensive ones</b>.
                </p>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-6">
                <img src="img/research_viz2.png" width="90%">
            </div>
            <div class="col-6">
                <img src="img/research_viz3.png" width="90%">
            </div>
        </div>
        <div align="center">
            <p class="content-margin"><b>üëá Ready to explore wines based on your flavor ? üëá</b></p>
            <a href="#taste"><button id="toTasteBtn" onclick="showTasteProfile()"><b>START</b></button></a>
        </div>
    </div>
</section>

<!--Taste Profile-->
<section class="section" id="taste">
   <div class="container">
       <h1 class="primary-title">Taste Profile</h1>
       <br>
       <!--wine type selection-->
       <div class="row">
           <img src="img/icon/flavor_step1.png" height="100%" style="padding-left: 1.2rem;">
           <div class="col-4">
               <p class="step-icon-align">Select your preferred wine type</p>
           </div>
           <div class="col-2" align="center">
               <img class="wine" id="White" src="img/wine/White.png" width="50%">
               <br>
               <p class="label">White Wine</p>
           </div>
           <div class="col-2" align="center">
               <img class="wine" id="Red" src="img/wine/Red.png" width="50%">
               <br>
               <p class="label">Red Wine</p>
           </div>
       </div>
       <br>
       <!--flavors selection-->
       <div class="row">
           <img id="flavor_step2" src="img/icon/flavor_step2.png" height="100%" style="padding-left: 1.2rem;">
           <div class="col-4" id="flavor_label_step2"></div>
       </div>
       <div class="row" id="flavor_choices"></div>
       <br>
       <!--error alert-->
       <div id="errorAlert"></div>
       <!--flavor viz-->
       <div class="row">
           <img id="flavor_step3" src="img/icon/flavor_step3.png" height="100%" style="padding-left: 1.2rem;">
           <div class="col-5" id="flavor_label_step3"></div>
           <div class="col-5 offset-1" id="flavor_viz"></div>
       </div>
       <div id="helper"></div>
   </div>
</section>

<!--Recommendation-->
<section id="recommendation">
    <div class="container">
        <div>
            <h1 class="primary-title-colored">The variety you selected</h1>
        </div>
        <div class="row">
            <div class="col-8 offset-2" id="details" align="center"></div>
        </div>
    </div>
</section>

<!-- <section id="recommendation">
    <div class="container">
        <div id="recommend_title"></div>
        <div class="row">
            <div class="col-8 offset-2" id="details" align="center"></div>
        </div>
    </div>
</section> --!>

<!--Tips-->
<section id="tips">
    <div class="container">
        <h1 class="primary-title">Before you leave, check out some tips</h1>
        <br>
        <p>
            Now, we believe you have some better idea of grape variety, aromas and price of wine you should start with as a novice.
            Here are 3 final tips to help you read other helpful attributes on the wine labels.
        </p>
        <br>
        <div align="center">
            <img src="img/tips.png" width="90%" align="center">
        </div>
    </div>
</section>

<footer class="footer">
    <div class="container">
        <h6 style="padding-top:15px;">UC Berkeley INFO247 Information Visualization and Presentation - Final Project</h6>
        <h6>Present to you by Yinan Chen, Yin Qiu, Xinran (Tracy) Wei</h6>
        <h6 id="end">
            <a href="#"><u>Final Report</u></a>
            <a href="#" style="margin-left:2rem;"><u>References</u></a>
            <span style="right:10%;position: absolute;">All Rights Reserved ¬© 2020 </span>
        </h6>
    </div>
</footer>
<script src="constants.js"></script>
<script>
    //navbar
    $(window).scroll(function() {
        if ($(document).scrollTop() > 30) {
            $('.navbar').addClass('shrink');
        } else {
            $('.navbar').removeClass('shrink');
        }
    });

    // control section display
    function showIntro(){
        $("#research").show();
    }

    function showTasteProfile(){
        $("#taste").show();
        $("#helper").show();
        // $(".footer").show();
    }

    function showRestSections(){
        $("#recommendation").show();
        $("#tips").show();
        $(".footer").show();
    }

    var wine = "";
    var flavor_select = ["",""];
    var flavor_count = 0;
    var flavor_reference = "";

    $(".wine").click(function(e){
        let curr = e.target;

        if(wine !== curr.id){
            //deselect selected one
            if(wine !== ""){
                $("#"+wine).attr("src",getWineImgPath(wine,false));

                //reset settings
                flavor_select = [","];
                flavor_count = 0;
                flavor_reference = "";
                cleanFlavorViz();
            }
            //update with selected wine type
            wine = curr.id;
            curr.src = getWineImgPath(wine,true);

            console.log(wine);

            //read data
            d3.csv(data_path+wine+".csv").then(function(data){
                console.log(wine+" dataset loaded successfully!");
                console.log(data[0]);
                //display flavor options based on selected wine type
                $("#flavor_step2").show();
                $("#flavor_label_step2").html("<p class='step-icon-align'>Choose you <b>TWO</b> favorite flavors: </p>");
                set_flavor_options(curr.id,data);
            });
        }
    });

    function set_flavor_options(type,data){
        let options = flavors[type];
        let htmlStr = "";

        options.forEach(function(flavor){
            let id = flavor;
            let name = flavor;
            if(flavor === "Floral"){
                id += type;
            }else if(flavor.includes("Fruit") || flavor.includes("Spice")){
                let subs = flavor.split(" ");
                id = subs[0]+subs[1];
            }
            htmlStr += "<div class='col-2' align='center'>" +
                            "<img class='flavor' id='"+id +"' alt='"+name +"' src='"+img_path+"flavor/"+id+".png"+"' width='50%'>" +
                            "<br>" +
                            "<p class='label'>"+name+"</p>" +
                            "</div>";
        });
        $("#flavor_choices").html(htmlStr);
        bindFlavorHoverEvent(type);
        bindFlavorClickEvent(data);
    }

    function bindFlavorHoverEvent(type){
        let dict = definitions[type];
        let flavors = Object.keys(dict);

        flavors.forEach(flavor => {
            let id = "#"+flavor;
            tippy(id, {
                content: dict[flavor],
                allowHTML: true,
                theme: 'wine',
                placement: 'top-start',
            });
        });
    }

    function bindFlavorClickEvent(data){
        $(".flavor").click(function(e){
            let curr = e.target;
            let error =  $("#errorAlert");

            if(curr.src === getFlavorImgPath(curr.id,false)){
                if(flavor_count < 2){
                    flavor_count === 0? flavor_select[0] = curr.id:flavor_select[1] = curr.id;
                    curr.src = getFlavorImgPath(curr.id,true);
                    flavor_count++;
                }else{
                    //choose more than two flavors => error handle
                    error.html(getErrorAlertHtmlStr());
                }
            }else {
                //clean
                error.html("");
                cleanFlavorViz();
                //show helper
                $("#helper").show();
                //deselect the selected one
                curr.src = getFlavorImgPath(curr.id,false);
                if(flavor_select[0] === curr.id)
                    flavor_select[0] = flavor_select[1];
                flavor_select[1] = "";
                flavor_count--;
            }

            console.log(flavor_select);

            //call to generate step3 part
            if(flavor_count === 2 &&  error.html() === ""){
                cleanFlavorViz();
                //display step3 label
                $("#flavor_step3").show();
                //set variety dropdown
                $("#flavor_label_step3").html(getFlavorStep3HtmlStr(data.map(d => d.Name)));
                bindDropdownClickEvent();
                //viz: use alphabetical order to set y/x with flavor names
                let flavors = [$("#"+flavor_select[0]).attr("alt"),$("#"+flavor_select[1]).attr("alt")];
                flavors.sort();
                getFlavorViz(data,flavors[0],flavors[1]);
                $("#helper").hide();
            }

        });
    }

    function bindDropdownClickEvent(){
        $(".dropdown-item").click(function(){
            let variety = $(this).text();
            $("#varietyBtn").text(variety+" ");
            console.log(variety);

            //update scatter image
            if(flavor_reference !== ""){
                let pre = $("#"+getVarietyId(flavor_reference));
                pre.attr("href","img/icon/grape.png");
                pre.attr("opacity","0.6");
            }
            let variety_id = getVarietyId(variety);
            let reference = $("#"+variety_id);
            reference.attr("href","img/icon/grape_reference.png");
            reference.attr("opacity","2.0");
            flavor_reference = variety;

        });
    }

    function getWineImgPath(name,selected){
        if(selected)
            return img_path+"wine/"+name+"_select.png";
        else
            return img_path+"wine/"+name+".png";
    }

    function getFlavorImgPath(name,selected){
        if(selected)
            return img_path+"flavor/"+name+"_select.png";
        else
            return img_path+"flavor/"+name+".png";
    }

    function getErrorAlertHtmlStr(){
        return "<div class='alert alert-danger alert-dismissible fade show' role='alert'>" +
                    "You could only select <strong>TWO</strong> flavors! Please deselect unwanted ones first." +
                    "<button type='button' class='close' data-dismiss='alert' aria-label='Close'>" +
                        "<span aria-hidden='true'>&times;</span>" +
                    "</button>" +
                "</div>"
    }

    function getFlavorStep3HtmlStr(varieties){
        //label
        htmlStr = "<p class='step-icon-align'><b>Hover & Click</b> on the flavor combination <img src='img/icon/grape.png'> " +
            "that you like to explore the associated wine varieties</p>";
        //dropdown title
        htmlStr += "<p>(Optional) Set your familiar wine variety as the reference <img src='img/icon/grape_reference.png'> to better understand the scale:</p>";
        //dropdown
        htmlStr += getVarietyDropDownHtmlStr(varieties);
        return htmlStr;
    }

    function getVarietyDropDownHtmlStr(varieties){
        htmlStr = "<div class='dropdown'>" +
                    "<button class='btn dropdown-toggle' type='button' id='varietyBtn' data-toggle='dropdown' aria-haspopup='true' aria-expanded='false'>" +
                        "Choose one familiar wine variety " +
                    "</button>" +
                  "<div class='dropdown-menu' aria-labelledby='varietyBtn'>";

        varieties.forEach(variety => {
           htmlStr += "<button class='dropdown-item' type='button'>"+ variety +"</button>"
        });

        return htmlStr += "</div></div>";
    }

    function cleanFlavorViz(){
        $("#flavor_step3").hide();
        $("#flavor_label_step3").html("");
        $("#flavor_viz").html("");
    }

    function getVarietyId(name){
        if(name.includes(" ")){
            let parts = name.split(" ");
            if(parts[0] === "Nero"){
                return parts[0];
            }
            return parts[0]+parts[1]
        }else{
            return name;
        }
    }
</script>
<script src="flavorViz.js"></script>
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</body>
</html>